<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDw4amrnoIcj1nvBeOlchzv5kBaD_sVSoE",
    authDomain: "clicon-oficial.firebaseapp.com",
    projectId: "clicon-oficial",
    storageBucket: "clicon-oficial.firebasestorage.app",
    messagingSenderId: "604078149403",
    appId: "1:604078149403:web:5da069e8254c3695028dbe"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Redirige al login si no hay sesión
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      window.location.href = "/Clicon-HTML/login/login.html";
    }
  });

  // Carga de módulo al tocar menú lateral
  document.querySelectorAll('.sidebar-menu li').forEach(item => {
    item.addEventListener('click', async () => {
      const view = item.getAttribute('data-view');
      const sections = document.querySelectorAll('.view-section');
      sections.forEach(s => s.classList.remove('active'));

      if (view === 'agregar') {
        try {
          const response = await fetch('modulo_agregar_empresa.html');
          const html = await response.text();
          const agregarSection = document.getElementById('agregar');
          agregarSection.innerHTML = html;
          agregarSection.classList.add('active');
        } catch (e) {
          console.error("No se pudo cargar el módulo:", e);
        }
      } else {
        const target = document.getElementById(view);
        if (target) {
          target.classList.add('active');
        }
      }

      document.querySelectorAll('.sidebar-menu li').forEach(li => li.classList.remove('active'));
      item.classList.add('active');
    });
  });
</script>
