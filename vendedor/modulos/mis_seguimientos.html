<!-- Contenedor donde se mostrar√°n los seguimientos -->
<div id="seguimientosContainer"></div>

<script type="module">
  // üîÅ Importamos m√≥dulos Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { getFirestore, collection, query, where, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  // üîê Configuraci√≥n del proyecto Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDw4amrnoIcj1nvBeOlchzv5kBaD_sVSoE",
    authDomain: "clicon-oficial.firebaseapp.com",
    projectId: "clicon-oficial",
    storageBucket: "clicon-oficial.appspot.com",
    messagingSenderId: "604078149403",
    appId: "1:604078149403:web:5da069e8254c3695028dbe"
  };

  // üöÄ Inicializamos Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore();

  // ‚úÖ Cuando el usuario est√© logueado, buscamos sus seguimientos
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("Debes iniciar sesi√≥n");
      return;
    }

    const email = user.email;
    const container = document.getElementById("seguimientosContainer");
    container.innerHTML = "";

    // üîé Buscar seguimientos del vendedor actual
    const q = query(collection(db, "seguimientos"), where("designado", "==", email));
    const querySnapshot = await getDocs(q);

    // üîÅ Mostrar cada seguimiento
    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const docId = docSnap.id;
      const estado = (data.estado || "").toUpperCase();

      // üé® Contenedor visual con estilo
      const card = document.createElement("div");
      card.style.border = "1px solid #ddd";
      card.style.borderRadius = "12px";
      card.style.padding = "16px";
      card.style.marginBottom = "16px";
      card.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
      card.style.fontFamily = "SF Pro Display, sans-serif";
      card.style.fontSize = "14px";

      // üé® Fondo seg√∫n estado
      if (estado === "VENTA") {
        card.style.background = "#d1f5d1"; // verde claro
      } else if (estado === "NO VENTA") {
        card.style.background = "#ffdede"; // rojo claro
      } else {
        card.style.background = "#F8FBFF"; // celeste claro (PENDIENTE o vac√≠o)
      }

      // üßæ Mostrar todos los campos din√°micamente
      let html = "";
      for (const campo in data) {
        html += `<div style="margin-bottom:4px;"><strong>${campo}:</strong> ${data[campo]}</div>`;
      }

      // ‚úÖ Botones para marcar venta o no venta
      html += `
        <div style="margin-top:10px;">
          <button style="margin-right:10px;" onclick="marcarEstado('${docId}', 'VENTA')">‚úÖ VENTA</button>
          <button onclick="marcarEstado('${docId}', 'NO VENTA')">‚ùå NO VENTA</button>
        </div>
      `;

      card.innerHTML = html;
      container.appendChild(card);
    });
  });

  // ‚úèÔ∏è Funci√≥n que actualiza solo el campo 'estado' del documento
  window.marcarEstado = async (docId, nuevoEstado) => {
    const docRef = doc(getFirestore(), "seguimientos", docId);
    await updateDoc(docRef, { estado: nuevoEstado });
    alert(`Cliente marcado como: ${nuevoEstado}`);
    location.reload(); // Refresca para actualizar visualmente
  };
</script>
