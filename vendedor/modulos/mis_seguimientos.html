<!-- Contenedor donde se mostrar√°n los seguimientos asignados -->
<div id="seguimientosContainer"></div>

<script type="module">
  // üîÅ Importamos Firebase y m√≥dulos necesarios
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { getFirestore, collection, query, where, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  // üîê Configuraci√≥n del proyecto Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDw4amrnoIcj1nvBeOlchzv5kBaD_sVSoE",
    authDomain: "clicon-oficial.firebaseapp.com",
    projectId: "clicon-oficial",
    storageBucket: "clicon-oficial.appspot.com",
    messagingSenderId: "604078149403",
    appId: "1:604078149403:web:5da069e8254c3695028dbe"
  };

  // üöÄ Inicializamos Firebase y sus servicios
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();       // M√≥dulo de autenticaci√≥n
  const db = getFirestore();    // M√≥dulo de base de datos Firestore

  // ‚úÖ Cuando el usuario est√© logueado, cargamos sus seguimientos
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("Debes iniciar sesi√≥n");
      return;
    }

    const email = user.email;
    const container = document.getElementById("seguimientosContainer");
    container.innerHTML = ""; // Limpiamos el contenedor

    // üîé Buscamos los seguimientos donde el campo 'designado' coincide con el email del vendedor
    const q = query(collection(db, "seguimientos"), where("designado", "==", email));
    const querySnapshot = await getDocs(q);

    // üì¶ Por cada documento encontrado, lo mostramos en pantalla
    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();     // Obtenemos los datos
      const docId = docSnap.id;        // Guardamos el ID para poder editarlo luego

      // üé® Creamos una tarjeta visual estilo CliCon
      const card = document.createElement("div");
      card.style.border = "1px solid #ddd";
      card.style.borderRadius = "12px";
      card.style.background = "#F8FBFF";
      card.style.padding = "16px";
      card.style.marginBottom = "16px";
      card.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
      card.style.fontFamily = "SF Pro Display, sans-serif";
      card.style.fontSize = "14px";

      // üîÅ Recorremos todos los campos y los mostramos autom√°ticamente
      let html = "";
      for (const campo in data) {
        html += `<div style="margin-bottom:4px;"><strong>${campo}:</strong> ${data[campo]}</div>`;
      }

      // ‚úÖ Agregamos botones de acci√≥n al final
      html += `
        <div style="margin-top:10px;">
          <button style="margin-right:10px;" onclick="marcarEstado('${docId}', 'VENTA')">‚úÖ VENTA</button>
          <button onclick="marcarEstado('${docId}', 'NO VENTA')">‚ùå NO VENTA</button>
        </div>
      `;

      card.innerHTML = html;
      container.appendChild(card);
    });
  });

  // ‚úèÔ∏è Funci√≥n global para actualizar el campo 'estado' del documento
  window.marcarEstado = async (docId, nuevoEstado) => {
    const docRef = doc(getFirestore(), "seguimientos", docId);   // Referencia al documento
    await updateDoc(docRef, { estado: nuevoEstado });            // Actualizamos solo el campo 'estado'
    alert(`Cliente marcado como: ${nuevoEstado}`);
    location.reload();  // Recargamos la p√°gina para reflejar el cambio
  };
</script>
